// ==========================================
// 1. مجموعة الأسئلة الكاملة (70 سؤال عن السعودية)
// ==========================================
const fullQuestionPool = [
    // --- التاريخ والتأسيس (1-10) ---
    { "id": 1, "question": "ما هو التاريخ الذي يوافق اليوم الوطني للمملكة العربية السعودية؟", "options": ["23 سبتمبر", "16 ديسمبر", "22 فبراير", "20 مايو"], "answer": "23 سبتمبر" },
    { "id": 2, "question": "ما هو الاسم الذي كان يطلق على المملكة قبل توحيدها؟", "options": ["إمارة نجد", "المملكة الحجازية", "مملكة الحجاز ونجد وملحقاتها", "الدولة السعودية الأولى"], "answer": "مملكة الحجاز ونجد وملحقاتها" },
    { "id": 3, "question": "متى تم توحيد المملكة العربية السعودية تحت اسم 'المملكة العربية السعودية'؟", "options": ["1902 م", "1932 م", "1953 م", "1975 م"], "answer": "1932 م" },
    { "id": 4, "question": "ما هي أول عاصمة للدولة السعودية الأولى؟", "options": ["الرياض", "الدرعية", "مكة المكرمة", "حائل"], "answer": "الدرعية" },
    { "id": 5, "question": "من هو الملك المؤسس للمملكة العربية السعودية؟", "options": ["الملك سعود", "الملك فيصل", "الملك خالد", "الملك عبد العزيز آل سعود"], "answer": "الملك عبد العزيز آل سعود" },
    { "id": 6, "question": "ما هو اليوم الذي يُحتفل فيه بذكرى تأسيس الدولة السعودية الأولى؟", "options": ["اليوم الوطني", "يوم العلم", "يوم التأسيس", "يوم المبايعة"], "answer": "يوم التأسيس" },
    { "id": 7, "question": "متى تولى خادم الحرمين الشريفين الملك سلمان بن عبد العزيز مقاليد الحكم؟", "options": ["2011 م", "2013 م", "2015 م", "2017 م"], "answer": "2015 م" },
    { "id": 8, "question": "ما هي المعركة الشهيرة التي استعاد فيها الملك عبد العزيز مدينة الرياض؟", "options": ["معركة السبلة", "معركة الصريف", "فتح الرياض (1902)", "معركة كنزان"], "answer": "فتح الرياض (1902)" },
    { "id": 9, "question": "من هو أول ملك تولى الحكم بعد الملك المؤسس؟", "options": ["الملك فيصل", "الملك سعود", "الملك خالد", "الملك فهد"], "answer": "الملك سعود" },
    { "id": 10, "question": "ما هو اللقب الذي يحمله ملك المملكة العربية السعودية؟", "options": ["ملك العرب", "خادم الحرمين الشريفين", "أمير المؤمنين", "ولي الأمر"], "answer": "خادم الحرمين الشريفين" },

    // --- الجغرافيا والمواقع (11-20) ---
    { "id": 11, "question": "ما هي عاصمة المملكة العربية السعودية؟", "options": ["جدة", "مكة المكرمة", "الرياض", "الدمام"], "answer": "الرياض" },
    { "id": 12, "question": "ما هو أعلى جبل في المملكة العربية السعودية؟", "options": ["جبل أحد", "جبل شمر", "جبل السودة", "جبل طويق"], "answer": "جبل السودة" },
    { "id": 13, "question": "كم يبلغ طول ساحل المملكة العربية السعودية على البحر الأحمر (تقريباً)؟", "options": ["500 كم", "1000 كم", "2000 كم", "2600 كم"], "answer": "2600 كم" },
    { "id": 14, "question": "ما هي أكبر منطقة إدارية في المملكة من حيث المساحة؟", "options": ["الرياض", "الشرقية", "المدينة المنورة", "تبوك"], "answer": "الشرقية" },
    { "id": 15, "question": "ما هو الميناء الأهم في المنطقة الغربية للمملكة؟", "options": ["ميناء الملك عبد العزيز بالدمام", "ميناء جازان", "ميناء جدة الإسلامي", "ميناء ينبع"], "answer": "ميناء جدة الإسلامي" },
    { "id": 16, "question": "ما هي الصحراء الرملية التي تغطي جزءاً كبيراً من جنوب شرق المملكة؟", "options": ["صحراء النفود", "الدهناء", "صحراء الربع الخالي", "صحراء صمان"], "answer": "صحراء الربع الخالي" },
    { "id": 17, "question": "ما اسم السلسلة الجبلية التي تمتد بمحاذاة ساحل البحر الأحمر؟", "options": ["جبال حائل", "جبال طويق", "جبال الحجاز (السروات)", "جبال العرمة"], "answer": "جبال الحجاز (السروات)" },
    { "id": 18, "question": "أي المدن السعودية هي 'بوابة الحرمين الشريفين'؟", "options": ["الرياض", "جدة", "المدينة المنورة", "الدمام"], "answer": "جدة" },
    { "id": 19, "question": "على أي خليج تقع مدينة الدمام؟", "options": ["الخليج العربي", "البحر الأحمر", "خليج العقبة", "البحر الأبيض المتوسط"], "answer": "الخليج العربي" },
    { "id": 20, "question": "ما هي المنطقة التي تقع بها مدائن صالح (الحِجر)؟", "options": ["القصيم", "تبوك", "المدينة المنورة", "العلا"], "answer": "العلا" },

    // --- رؤية 2030 والمشاريع (21-30) ---
    { "id": 21, "question": "متى تم إطلاق رؤية المملكة 2030؟", "options": ["2014", "2016", "2018", "2020"], "answer": "2016" },
    { "id": 22, "question": "من هو رئيس مجلس إدارة صندوق الاستثمارات العامة (PIF)؟", "options": ["الملك سلمان", "الأمير محمد بن سلمان", "الأمير فيصل بن فرحان", "الشيخ صالح آل الشيخ"], "answer": "الأمير محمد بن سلمان" },
    { "id": 23, "question": "ما هو الاسم الذي أُطلق على خط المدينة الذكية 'نيوم' الخالي من المركبات والشارع؟", "options": ["المكعب", "الرياض الخضراء", "ذا لاين (The Line)", "البحر الأحمر"], "answer": "ذا لاين (The Line)" },
    { "id": 24, "question": "ما هو الهدف الرئيسي لرؤية 2030 فيما يتعلق بالنفط؟", "options": ["زيادة إنتاج النفط", "تطوير حقول جديدة", "تنويع مصادر الدخل وعدم الاعتماد على النفط", "تخفيض أسعار النفط"], "answer": "تنويع مصادر الدخل وعدم الاعتماد على النفط" },
    { "id": 25, "question": "ما اسم المشروع الذي يهدف لتطوير قلب مدينة الرياض وتحويله إلى وجهة سياحية وتاريخية؟", "options": ["مشروع القدية", "مشروع الدرعية", "مشروع وسط جدة", "مشروع أمالا"], "answer": "مشروع الدرعية" },
    { "id": 26, "question": "ما اسم المشروع الذي يستهدف إنشاء وجهة سياحية فاخرة على ساحل البحر الأحمر؟", "options": ["نيوم", "مشروع البحر الأحمر", "مشروع القدية", "مشروع أمالا"], "answer": "مشروع البحر الأحمر" },
    { "id": 27, "question": "ما هي النسبة المستهدفة لمشاركة المرأة في سوق العمل السعودي ضمن رؤية 2030؟", "options": ["22%", "30%", "35%", "40%"], "answer": "30%" },
    { "id": 28, "question": "ما هي المبادرة التي تهدف إلى زراعة 10 مليارات شجرة في المملكة؟", "options": ["السعودية الخضراء", "الصحراء المورقة", "الرياض الخضراء", "أخضر السعودية"], "answer": "السعودية الخضراء" },
    { "id": 29, "question": "ما هو الهدف من برنامج 'شريك'؟", "options": ["جذب المستثمرين الأجانب", "دعم الشركات العائلية", "تمكين الشركات السعودية الكبرى", "تطوير القطاع العقاري"], "answer": "تمكين الشركات السعودية الكبرى" },
    { "id": 30, "question": "ما هي الهيئة المسؤولة عن تنظيم قطاع الترفيه في المملكة؟", "options": ["هيئة الثقافة", "هيئة السياحة", "الهيئة العامة للترفيه", "وزارة الرياضة"], "answer": "الهيئة العامة للترفيه" },

    // --- الثقافة والتعليم (31-40) ---
    { "id": 31, "question": "ما هو شعار المملكة العربية السعودية الرسمي؟", "options": ["الخيل والسيف", "النخلة والرمح", "السيفان والنخلة", "البحر والسيف"], "answer": "السيفان والنخلة" },
    { "id": 32, "question": "ما هي العملة الرسمية للمملكة العربية السعودية؟", "options": ["الدينار", "الريال السعودي", "الجنيه السعودي", "الدرهم"], "answer": "الريال السعودي" },
    { "id": 33, "question": "ما هو الاسم الذي يطلق على اللباس التقليدي للرجال في المملكة؟", "options": ["الدشداشة", "الثوب", "الجلابية", "القفطان"], "answer": "الثوب" },
    { "id": 34, "question": "ما هي أول جامعة حكومية سعودية تأسست في المملكة؟", "options": ["جامعة الملك فهد للبترول والمعادن", "جامعة الملك سعود", "جامعة الملك عبد العزيز", "جامعة الإمام محمد بن سعود"], "answer": "جامعة الملك سعود" },
    { "id": 35, "question": "ما هو اسم الفن الشعبي الشهير المرتبط بالمناطق الجنوبية؟", "options": ["السامري", "الدحة", "العرضة النجدية", "الخطوة الجنوبية"], "answer": "الخطوة الجنوبية" },
    { "id": 36, "question": "ما اسم أول رائدة فضاء سعودية وعربية؟", "options": ["مشاعل الشميمري", "ريانة برناوي", "هبة الجبالي", "سارة الأميري"], "answer": "ريانة برناوي" },
    { "id": 37, "question": "ما هي أول مدينة سعودية تنظم سباق فورمولا إي؟", "options": ["جدة", "الرياض", "الدرعية", "الدمام"], "answer": "الدرعية" },
    { "id": 38, "question": "ما هو نوع المطبخ الذي اشتهرت به منطقة الحجاز، ويقدم مع اللحم والزبيب؟", "options": ["الكبسة", "المندي", "السليق", "المقلقل"], "answer": "السليق" },
    { "id": 39, "question": "ما هي الهيئة التي تشرف على الفعاليات الثقافية مثل معارض الكتب والمتاحف؟", "options": ["وزارة السياحة", "الهيئة العامة للرياضة", "وزارة الثقافة", "الهيئة العامة للترفيه"], "answer": "وزارة الثقافة" },
    { "id": 40, "question": "ما هو لون شريط العلم السعودي؟", "options": ["أحمر", "أبيض", "أخضر", "أسود"], "answer": "أخضر" },

    // --- الأماكن الدينية والاقتصاد (41-50) ---
    { "id": 41, "question": "ما اسم المسجد الذي يقع في المدينة المنورة ويعرف بأنه أول مسجد بني في الإسلام؟", "options": ["المسجد النبوي", "مسجد قباء", "المسجد الحرام", "مسجد القبلتين"], "answer": "مسجد قباء" },
    { "id": 42, "question": "أين تقع الكعبة المشرفة؟", "options": ["المدينة المنورة", "الرياض", "مكة المكرمة", "جدة"], "answer": "مكة المكرمة" },
    { "id": 43, "question": "ما هي أكبر شركة نفط وغاز في العالم ومقرها المملكة العربية السعودية؟", "options": ["سابك", "معادن", "أرامكو السعودية", "التصنيع"], "answer": "أرامكو السعودية" },
    { "id": 44, "question": "ما هو 'المطاف' في المسجد الحرام؟", "options": ["مكان صلاة الجماعة", "المكان المخصص للسعي", "المكان المخصص للطواف حول الكعبة", "مكان دفن الصحابة"], "answer": "المكان المخصص للطواف حول الكعبة" },
    { "id": 45, "question": "ما هو القطاع الذي يشكل أكبر مصدر للدخل للمملكة تاريخياً؟", "options": ["السياحة", "الصناعات التحويلية", "الزراعة", "النفط والغاز"], "answer": "النفط والغاز" },
    { "id": 46, "question": "ما اسم المؤسسة النقدية التي تصدر العملة السعودية؟", "options": ["البنك الأهلي السعودي", "مصرف الراجحي", "البنك المركزي السعودي (ساما)", "البنك السعودي الفرنسي"], "answer": "البنك المركزي السعودي (ساما)" },
    { "id": 47, "question": "ما اسم البئر الذي ينسب إليه اكتشاف النفط بكميات تجارية لأول مرة في المملكة؟", "options": ["بئر رقم 1", "بئر الدمام رقم 7", "بئر الخير", "بئر الغوار"], "answer": "بئر الدمام رقم 7" },
    { "id": 48, "question": "في أي مدينة يقع المسجد النبوي الشريف؟", "options": ["مكة المكرمة", "جدة", "المدينة المنورة", "الطائف"], "answer": "المدينة المنورة" },
    { "id": 49, "question": "متى تبدأ مناسك الحج رسمياً؟", "options": ["1 ذو القعدة", "10 ذو الحجة", "8 ذو الحجة", "1 محرم"], "answer": "8 ذو الحجة" },
    { "id": 50, "question": "ما هي المدينة التي كانت عاصمة الدولة السعودية الثانية؟", "options": ["الرياض", "الدرعية", "الأحساء", "الدمام"], "answer": "الرياض" },

    // --- أسئلة متنوعة وإنجازات (51-60) ---
    { "id": 51, "question": "ما اسم الجسر الذي يربط المملكة العربية السعودية بمملكة البحرين؟", "options": ["جسر الملك فهد", "جسر الملك خالد", "جسر الصداقة", "جسر الخليج"], "answer": "جسر الملك فهد" },
    { "id": 52, "question": "ما هي الرياضة التي شهدت أول فريق نسائي سعودي مشارك في بطولة دولية؟", "options": ["كرة القدم", "كرة السلة", "المبارزة", "الفروسية"], "answer": "المبارزة" },
    { "id": 53, "question": "ما اسم أول مركز تجاري ضخم تم افتتاحه في الرياض؟", "options": ["الرياض جاليري", "سنتريا مول", "الفيصلية مول", "العليا مول"], "answer": "الفيصلية مول" },
    { "id": 54, "question": "في أي عام تم السماح للمرأة بقيادة السيارة في المملكة؟", "options": ["2016", "2018", "2020", "2022"], "answer": "2018" },
    { "id": 55, "question": "ما هي الدولة التي تحد المملكة من جهة الشمال الشرقي؟", "options": ["اليمن", "العراق", "الأردن", "الكويت"], "answer": "الكويت" },
    { "id": 56, "question": "ما هو اسم الحي التراثي التاريخي الذي يقع في الدرعية وتم إدراجه في قائمة اليونسكو؟", "options": ["حي البجيري", "حي البطحاء", "حي الطريف", "حي القصور"], "answer": "حي الطريف" },
    { "id": 57, "question": "ما هي أول قناة فضائية سعودية تم إطلاقها؟", "options": ["العربية", "السعودية (القناة الأولى سابقاً)", "الإخبارية", "روتانا"], "answer": "السعودية (القناة الأولى سابقاً)" },
    { "id": 58, "question": "ما هو الحدث العالمي الذي استضافته المملكة ويخص سباقات السيارات في منطقة الدرعية؟", "options": ["فورمولا 1", "سباق رالي داكار", "فورمولا إي", "سباق ناسكار"], "answer": "فورمولا إي" },
    { "id": 59, "question": "ما هي الهيئة المسؤولة عن تنظيم وتطوير قطاع السياحة؟", "options": ["وزارة الثقافة", "الهيئة العامة للطيران المدني", "وزارة السياحة", "الهيئة العامة للرياضة"], "answer": "وزارة السياحة" },
    { "id": 60, "question": "ما هو اسم المنطقة التي تعرف بأنها 'عاصمة التمور' في المملكة؟", "options": ["الرياض", "القصيم (بريدة تحديداً)", "الأحساء", "جازان"], "answer": "القصيم (بريدة تحديداً)" },

    // --- تكملة أسئلة متنوعة (61-70) ---
    { "id": 61, "question": "ما هي أكبر جامعة نسائية في العالم وتقع في الرياض؟", "options": ["جامعة الأميرة نورة", "جامعة الملك سعود", "جامعة الملك عبد العزيز", "جامعة الإمام محمد بن سعود"], "answer": "جامعة الأميرة نورة" },
    { "id": 62, "question": "ما اسم الشاعر السعودي الذي كتب النشيد الوطني (سارعي للمجد والعلياء)؟", "options": ["إبراهيم خفاجي", "غازي القصيبي", "بدر بن عبد المحسن", "محمد بن فطيس"], "answer": "إبراهيم خفاجي" },
    { "id": 63, "question": "ما هي المؤسسة التي تأسست عام 1975 وتلعب دوراً رئيسياً في التنمية الاقتصادية والاجتماعية في الدول النامية؟", "options": ["البنك الأهلي السعودي", "صندوق الاستثمارات العامة", "صندوق التنمية السعودي", "البنك الإسلامي للتنمية"], "answer": "البنك الإسلامي للتنمية" },
    { "id": 64, "question": "ما هو المنتج الزراعي الذي تشتهر به منطقة الجوف؟", "options": ["التمور", "الزيتون", "القمح", "العنب"], "answer": "الزيتون" },
    { "id": 65, "question": "ما اسم المدينة السعودية التي تُعرف بـ 'مدينة الورود' أو 'مصيف المملكة'؟", "options": ["أبها", "الطائف", "الباحة", "تبوك"], "answer": "الطائف" },
    { "id": 66, "question": "كم عدد الدول التي تحد المملكة العربية السعودية براً؟", "options": ["5", "6", "7", "8"], "answer": "7" },
    { "id": 67, "question": "ما هي الجهة الحكومية المسؤولة عن تنظيم قطاع الاتصالات وتقنية المعلومات؟", "options": ["هيئة الإذاعة والتلفزيون", "هيئة الاتصالات والفضاء والتقنية", "وزارة التجارة", "وزارة المالية"], "answer": "هيئة الاتصالات والفضاء والتقنية" },
    { "id": 68, "question": "في أي مدينة يقع مقر مجلس التعاون لدول الخليج العربية؟", "options": ["جدة", "أبو ظبي", "الرياض", "الدوحة"], "answer": "الرياض" },
    { "id": 69, "question": "ما هو الاسم القديم لمدينة حائل؟", "options": ["جبة", "فدك", "الروضة", "جبة"], "answer": "جبة" }, 
    { "id": 70, "question": "ما هو أكبر مركز مالي في الشرق الأوسط ويقع في الرياض؟", "options": ["مركز الملك فهد الثقافي", "مركز الملك عبد الله المالي (KAFD)", "برج المملكة", "مركز الفيصلية"], "answer": "مركز الملك عبد الله المالي (KAFD)" }
];


// عناصر DOM الرئيسية
const questionPage = document.getElementById('question-page');
const resultsPage = document.getElementById('results-page');
const questionText = document.getElementById('question-text');
const optionsGrid = document.getElementById('options-grid');
const timerDisplay = document.getElementById('timer');
const nextButton = document.getElementById('next-button'); 

// متغيرات حالة اللعبة
let currentQuestionIndex = 0;
let timerInterval;
const TIME_LIMIT = 10; 
let userAnswers = [];
let timeRemaining = TIME_LIMIT;
let quizQuestions = []; // مصفوفة لحفظ الـ 10 أسئلة المختارة


// ==========================================
// 2. دوال الخلط والاختيار
// ==========================================

/**
 * دالة خلط مصفوفة (Fisher-Yates Shuffle)
 */
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

/**
 * دالة لخلط جميع الأسئلة واختيار 10 منها فقط.
 */
function getShuffledQuizQuestions(pool, count) {
    const shuffledPool = shuffleArray([...pool]); 
    return shuffledPool.slice(0, count);
}


// ==========================================
// 3. منطق اللعبة
// ==========================================

function displayQuestion() {
    clearInterval(timerInterval);
    timeRemaining = TIME_LIMIT;
    timerDisplay.textContent = timeRemaining;

    if (currentQuestionIndex >= quizQuestions.length) {
        showResults();
        return;
    }

    const currentQuestion = quizQuestions[currentQuestionIndex];
    questionText.textContent = currentQuestion.question;
    optionsGrid.innerHTML = ''; 

    const shuffledOptions = shuffleArray([...currentQuestion.options]);

    shuffledOptions.forEach(option => {
        const button = document.createElement('button');
        button.textContent = option;
        button.classList.add('option-button');
        button.onclick = () => selectAnswer(option, button);
        optionsGrid.appendChild(button);
    });

    startTimer();
}


function startTimer() {
    timerInterval = setInterval(() => {
        timeRemaining--;
        timerDisplay.textContent = timeRemaining;

        if (timeRemaining <= 0) {
            clearInterval(timerInterval);
            handleTimeout();
        }
    }, 1000); 
}


function selectAnswer(selectedOption, selectedButton) {
    clearInterval(timerInterval);

    Array.from(optionsGrid.children).forEach(btn => btn.disabled = true);
    selectedButton.classList.add('selected');
    userAnswers[currentQuestionIndex] = selectedOption;
    
    setTimeout(goToNextQuestion, 500); 
}


function handleTimeout() {
    Array.from(optionsGrid.children).forEach(btn => btn.disabled = true);
    userAnswers[currentQuestionIndex] = "SKIP";
    
    setTimeout(goToNextQuestion, 500); 
}


function goToNextQuestion() {
    currentQuestionIndex++;
    displayQuestion();
}

nextButton.onclick = goToNextQuestion; 


function showResults() {
    questionPage.classList.remove('active');
    resultsPage.classList.add('active');
    
    let correctCount = 0;
    let wrongCount = 0;
    let skippedCount = 0;
    
    document.getElementById('results-details').innerHTML = ''; 

    quizQuestions.forEach((question, index) => {
        const userAnswer = userAnswers[index];
        const isCorrect = (userAnswer === question.answer);
        
        const resultCard = document.createElement('div');
        resultCard.classList.add('card');
        
        let statusClass = 'skipped';
        let statusText = 'لم تتم الإجابة';

        if (userAnswer && userAnswer !== 'SKIP') {
            if (isCorrect) {
                correctCount++;
                statusClass = 'correct';
                statusText = 'صحيحة';
            } else {
                wrongCount++;
                statusClass = 'wrong';
                statusText = 'خاطئة';
            }
        } else {
            skippedCount++;
        }

        resultCard.classList.add(statusClass);

        resultCard.innerHTML = `
            <p><strong>سؤال ${index + 1}:</strong> ${question.question}</p>
            <p><strong>إجابتك:</strong> ${userAnswer === 'SKIP' ? 'لم تجب' : (userAnswer || 'لم تجب')}</p>
            <p><strong>الإجابة الصحيحة:</strong> ${question.answer}</p>
            <p class="result-status">الحالة: ${statusText}</p>
        `;

        document.getElementById('results-details').appendChild(resultCard);
    });

    document.getElementById('correct-count').textContent = correctCount;
    document.getElementById('wrong-count').textContent = wrongCount;
    document.getElementById('skipped-count').textContent = skippedCount;
}


// **دالة تهيئة اللعبة: اختيار 10 أسئلة مخلطة عند التحميل**
function initializeQuiz() {
    quizQuestions = getShuffledQuizQuestions(fullQuestionPool, 10);
    displayQuestion();
}

// بدء اللعبة
document.addEventListener('DOMContentLoaded', initializeQuiz);
